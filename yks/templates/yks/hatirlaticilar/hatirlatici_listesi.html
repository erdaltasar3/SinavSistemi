{% extends 'base.html' %}

{% block title %}Hatırlatıcılar - YKS Hazırlık{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- YKS Hazırlık Navigasyon Menüsü -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm">
                <div class="card-body p-0">
                    <nav class="nav nav-pills nav-fill">
                        <a class="nav-link" href="{% url 'yks:hedef_listesi' %}">
                            <i class="bi bi-bullseye me-2"></i> Hedeflerim
                        </a>
                        <a class="nav-link" href="{% url 'yks:calisma_plani_listesi' %}">
                            <i class="bi bi-calendar3-week me-2"></i> Çalışma Planı
                        </a>
                        <a class="nav-link active" href="{% url 'yks:hatirlatici_listesi' %}">
                            <i class="bi bi-bell me-2"></i> Hatırlatıcılar
                        </a>
                    </nav>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Sol Sidebar -->
        <div class="col-lg-3 mb-4">
            <div class="d-grid gap-3">
                <!-- Özet Kartı -->
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-warning text-dark py-3">
                        <h5 class="mb-0"><i class="bi bi-bell-fill me-2"></i> Hatırlatıcı Özeti</h5>
                    </div>
                    <div class="card-body">
                        <div class="text-center mb-4">
                            <div class="rounded-circle bg-warning bg-opacity-10 p-4 mx-auto mb-3" style="width: 100px; height: 100px;">
                                <i class="bi bi-alarm-fill text-warning fs-1"></i>
                            </div>
                            <h5>{{ request.user.get_full_name|default:request.user.username }}</h5>
                            <p class="text-muted small">YKS Hazırlık Dönemi</p>
                        </div>
                        
                        <h6 class="fw-bold border-bottom pb-2">Bugünkü Hatırlatıcılar</h6>
                        {% if bugunun_hatirlaticilari %}
                            {% for hatirlatici in bugunun_hatirlaticilari|slice:":3" %}
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <span class="text-truncate">{{ hatirlatici.baslik }}</span>
                                    <span class="badge bg-warning text-dark">{{ hatirlatici.hatirlatma_tarihi|time:"H:i" }}</span>
                                </div>
                            {% endfor %}
                            {% if bugunun_hatirlaticilari.count > 3 %}
                                <div class="text-center mt-2">
                                    <small class="text-muted">+{{ bugunun_hatirlaticilari.count|add:"-3" }} daha...</small>
                                </div>
                            {% endif %}
                        {% else %}
                            <p class="text-muted small text-center">Bugün için planlanmış hatırlatıcı bulunmuyor.</p>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Hızlı Erişim Menüsü -->
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white py-3">
                        <h5 class="mb-0"><i class="bi bi-lightning-charge me-2"></i> Hızlı Erişim</h5>
                    </div>
                    <div class="card-body p-0">
                        <div class="list-group list-group-flush">
                            <a href="{% url 'yks:hatirlatici_ekle' %}" class="list-group-item list-group-item-action py-3" id="addReminderBtnQuickAccess">
                                <i class="bi bi-plus-circle-fill text-success me-2"></i> Yeni Hatırlatıcı Ekle
                            </a>
                            <a href="{% url 'yks:hedef_ekle' %}" class="list-group-item list-group-item-action py-3">
                                <i class="bi bi-bullseye-fill text-primary me-2"></i> Hedef Oluştur
                            </a>
                            <a href="{% url 'yks:calisma_plani_ekle' %}" class="list-group-item list-group-item-action py-3">
                                <i class="bi bi-calendar-plus-fill text-info me-2"></i> Çalışma Planı Oluştur
                            </a>
                        </div>
                    </div>
                </div>
                
                <!-- Motivasyon Kartı -->
                <div class="card border-0 shadow-sm bg-light">
                    <div class="card-body">
                        <h5 class="card-title mb-3"><i class="bi bi-quote me-2"></i> Hatırlatma</h5>
                        <figure>
                            <blockquote class="blockquote">
                                <p>Zamanın kontrolü, başarının anahtarıdır.</p>
                            </blockquote>
                            <figcaption class="blockquote-footer mb-0">
                                YKS Hazırlık Mentoru
                            </figcaption>
                        </figure>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Ana İçerik Alanı -->
        <div class="col-lg-9">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="h2 mb-0">Hatırlatıcılar <span id="liveClock" class="fw-bold ms-4"></span></h1>
                <a href="{% url 'yks:hatirlatici_ekle' %}" class="btn btn-warning" id="addReminderBtnMain" data-email-verified="{{ email_verified|lower }}">
                    <i class="bi bi-plus-circle me-2"></i> Yeni Hatırlatıcı Ekle
                </a>
            </div>

            <!-- İstatistikler -->
            <div class="row g-4 mb-4">
                <div class="col-md-4">
                    <div class="card border-0 shadow-sm h-100 border-start border-5 border-warning">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="rounded-circle bg-warning bg-opacity-10 p-3 me-3">
                                    <i class="bi bi-bell-fill text-warning fs-4"></i>
                                </div>
                                <div>
                                    <h6 class="text-muted mb-1">Toplam Hatırlatıcı</h6>
                                    <h2 class="display-6 fw-bold mb-0">{{ toplam_hatirlatici_sayisi }}</h2>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card border-0 shadow-sm h-100 border-start border-5 border-success">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="rounded-circle bg-success bg-opacity-10 p-3 me-3">
                                    <i class="bi bi-calendar2-week text-success fs-4"></i>
                                </div>
                                <div>
                                    <h6 class="text-muted mb-1">Bugünkü Hatırlatıcılar</h6>
                                    <h2 class="display-6 fw-bold mb-0">{{ bugunku_hatirlatici_sayisi }}</h2>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card border-0 shadow-sm h-100 border-start border-5 border-info">
                        <div class="card-body">
                            <div class="d-flex align-items-center">
                                <div class="rounded-circle bg-info bg-opacity-10 p-3 me-3">
                                    <i class="bi bi-clock-history text-info fs-4"></i>
                                </div>
                                <div>
                                    <h6 class="text-muted mb-1">Yaklaşan Hatırlatıcılar</h6>
                                    <h2 class="display-6 fw-bold mb-0">{{ yaklasan_hatirlatici_sayisi }}</h2>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Hatırlatıcı Kategorileri Sekmeler -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white p-0">
                    <ul class="nav nav-tabs card-header-tabs" id="hatirlaticiTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="bugun-tab" data-bs-toggle="tab" data-bs-target="#bugun" 
                                    type="button" role="tab" aria-controls="bugun" aria-selected="true">
                                <i class="bi bi-calendar-day me-2"></i> Bugün
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="yaklasan-tab" data-bs-toggle="tab" data-bs-target="#yaklasan" 
                                    type="button" role="tab" aria-controls="yaklasan" aria-selected="false">
                                <i class="bi bi-calendar-range me-2"></i> Yaklaşan
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="gecmis-tab" data-bs-toggle="tab" data-bs-target="#gecmis" 
                                    type="button" role="tab" aria-controls="gecmis" aria-selected="false">
                                <i class="bi bi-calendar-x me-2"></i> Geçmiş
                            </button>
                        </li>
                    </ul>
                </div>
                <div class="card-body p-0">
                    <div class="tab-content" id="hatirlaticiTabContent">
                        <!-- Bugünkü Hatırlatıcılar Sekmesi -->
                        <div class="tab-pane fade show active" id="bugun" role="tabpanel" aria-labelledby="bugun-tab">
                            {% if bugunun_hatirlaticilari %}
                                <div class="table-responsive">
                                    <table class="table align-middle table-hover mb-0">
                                        <thead class="table-light">
                                            <tr>
                                                <th scope="col" style="width: 50%">Hatırlatıcı</th>
                                                <th scope="col">Saat</th>
                                                <th scope="col">Durum</th>
                                                <th scope="col" style="width: 20%">İşlemler</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for hatirlatici in bugunun_hatirlaticilari %}
                                                <tr class="{% if not hatirlatici.aktif %}table-secondary{% endif %}">
                                                    <td>
                                                        <div class="fw-bold">{{ hatirlatici.baslik }}</div>
                                                        {% if hatirlatici.aciklama %}
                                                            <small class="text-muted d-block text-truncate" style="max-width: 300px;">{{ hatirlatici.aciklama }}</small>
                                                        {% endif %}
                                                    </td>
                                                    <td>
                                                        <span class="badge bg-warning text-dark">{{ hatirlatici.hatirlatma_tarihi|time:"H:i" }}</span>
                                                    </td>
                                                    <td>
                                                        {% if hatirlatici.aktif %}
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input hatirlatici-aktif-switch" type="checkbox" role="switch" id="aktifSwitch-bugun-{{ hatirlatici.id }}" data-hatirlatici-id="{{ hatirlatici.id }}" {% if hatirlatici.aktif %}checked{% endif %}>
                                                                <label class="form-check-label" for="aktifSwitch-bugun-{{ hatirlatici.id }}"><span class="badge bg-success">Aktif</span></label>
                                                            </div>
                                                        {% else %}
                                                             <div class="form-check form-switch">
                                                                <input class="form-check-input hatirlatici-aktif-switch" type="checkbox" role="switch" id="aktifSwitch-bugun-{{ hatirlatici.id }}" data-hatirlatici-id="{{ hatirlatici.id }}" {% if hatirlatici.aktif %}checked{% endif %}>
                                                                 <label class="form-check-label" for="aktifSwitch-bugun-{{ hatirlatici.id }}"><span class="badge bg-secondary">Pasif</span></label>
                                                            </div>
                                                        {% endif %}
                                                    </td>
                                                    <td>
                                                        <div class="btn-group" role="group">
                                                            <button type="button" class="btn btn-sm btn-outline-danger delete-hatirlatici-icon" data-bs-toggle="modal" data-bs-target="#deleteConfirmationModal" data-hatirlatici-id="{{ hatirlatici.id }}">
                                                                <i class="bi bi-trash-fill"></i>
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            {% else %}
                                <div class="p-5 text-center">
                                    <div class="py-5">
                                        <i class="bi bi-calendar-check text-muted display-1 mb-3"></i>
                                        <h4>Bugün İçin Hatırlatıcı Yok</h4>
                                        <p class="text-muted">Bugün için planlanmış bir hatırlatıcı bulunmuyor.</p>
                                        <a href="{% url 'yks:hatirlatici_ekle' %}" class="btn btn-primary mt-3">
                                            <i class="bi bi-plus-circle me-2"></i> Hatırlatıcı Ekle
                                        </a>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                        
                        <!-- Yaklaşan Hatırlatıcılar Sekmesi -->
                        <div class="tab-pane fade" id="yaklasan" role="tabpanel" aria-labelledby="yaklasan-tab">
                            {% if yaklasan_hatirlaticilar_tab %}
                                <div class="table-responsive">
                                    <table class="table align-middle table-hover mb-0">
                                        <thead class="table-light">
                                            <tr>
                                                <th scope="col" style="width: 40%">Hatırlatıcı</th>
                                                <th scope="col">Tarih & Saat</th>
                                                <th scope="col">Durum</th>
                                                <th scope="col" style="width: 20%">İşlemler</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for hatirlatici in yaklasan_hatirlaticilar_tab %}
                                                <tr class="{% if not hatirlatici.aktif %}table-secondary{% endif %}">
                                                    <td>
                                                        <div class="fw-bold">{{ hatirlatici.baslik }}</div>
                                                        {% if hatirlatici.aciklama %}
                                                            <small class="text-muted d-block text-truncate" style="max-width: 300px;">{{ hatirlatici.aciklama }}</small>
                                                        {% endif %}
                                                    </td>
                                                    <td>
                                                        <div class="d-flex flex-column">
                                                            <span class="badge bg-light text-dark mb-1">
                                                                <i class="bi bi-calendar3 text-primary me-1"></i> {{ hatirlatici.hatirlatma_tarihi|date:"d.m.Y" }}
                                                            </span>
                                                            <span class="badge bg-warning text-dark">
                                                                <i class="bi bi-clock me-1"></i> {{ hatirlatici.hatirlatma_tarihi|time:"H:i" }}
                                                            </span>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        {% if hatirlatici.aktif %}
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input hatirlatici-aktif-switch" type="checkbox" role="switch" id="aktifSwitch-yaklasan-{{ hatirlatici.id }}" data-hatirlatici-id="{{ hatirlatici.id }}" {% if hatirlatici.aktif %}checked{% endif %}>
                                                                <label class="form-check-label" for="aktifSwitch-yaklasan-{{ hatirlatici.id }}"><span class="badge bg-success">Aktif</span></label>
                                                            </div>
                                                        {% else %}
                                                             <div class="form-check form-switch">
                                                                <input class="form-check-input hatirlatici-aktif-switch" type="checkbox" role="switch" id="aktifSwitch-yaklasan-{{ hatirlatici.id }}" data-hatirlatici-id="{{ hatirlatici.id }}" {% if hatirlatici.aktif %}checked{% endif %}>
                                                                 <label class="form-check-label" for="aktifSwitch-yaklasan-{{ hatirlatici.id }}"><span class="badge bg-secondary">Pasif</span></label>
                                                            </div>
                                                        {% endif %}
                                                    </td>
                                                    <td>
                                                        <div class="btn-group" role="group">
                                                            <button type="button" class="btn btn-sm btn-outline-danger delete-hatirlatici-icon" data-bs-toggle="modal" data-bs-target="#deleteConfirmationModal" data-hatirlatici-id="{{ hatirlatici.id }}">
                                                                <i class="bi bi-trash-fill"></i>
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            {% else %}
                                <div class="p-5 text-center">
                                    <div class="py-5">
                                        <i class="bi bi-calendar-range text-muted display-1 mb-3"></i>
                                        <h4>Yaklaşan Hatırlatıcı Yok</h4>
                                        <p class="text-muted">Yaklaşan hatırlatıcınız bulunmuyor.</p>
                                        <a href="{% url 'yks:hatirlatici_ekle' %}" class="btn btn-primary mt-3">
                                            <i class="bi bi-plus-circle me-2"></i> Hatırlatıcı Ekle
                                        </a>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                        
                        <!-- Geçmiş Hatırlatıcılar Sekmesi -->
                        <div class="tab-pane fade" id="gecmis" role="tabpanel" aria-labelledby="gecmis-tab">
                            {% if gecmis_hatirlaticilar_tab %}
                                <div class="table-responsive">
                                    <table class="table align-middle table-hover mb-0">
                                        <thead class="table-light">
                                            <tr>
                                                <th scope="col" style="width: 40%">Hatırlatıcı</th>
                                                <th scope="col">Tarih & Saat</th>
                                                <th scope="col">Durum</th>
                                                <th scope="col" style="width: 20%">İşlemler</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for hatirlatici in gecmis_hatirlaticilar_tab %}
                                                <tr class="{% if not hatirlatici.aktif %}table-secondary{% endif %}">
                                                    <td>
                                                        <div class="fw-bold">{{ hatirlatici.baslik }}</div>
                                                        {% if hatirlatici.aciklama %}
                                                            <small class="text-muted d-block text-truncate" style="max-width: 300px;">{{ hatirlatici.aciklama }}</small>
                                                        {% endif %}
                                                    </td>
                                                    <td>
                                                        <div class="d-flex flex-column">
                                                            <span class="badge bg-light text-dark mb-1">
                                                                <i class="bi bi-calendar3 text-secondary me-1"></i> {{ hatirlatici.hatirlatma_tarihi|date:"d.m.Y" }}
                                                            </span>
                                                            <span class="badge bg-secondary text-white">
                                                                <i class="bi bi-clock me-1"></i> {{ hatirlatici.hatirlatma_tarihi|time:"H:i" }}
                                                            </span>
                                                        </div>
                                                    </td>
                                                     <td>
                                                        {% if hatirlatici.aktif %}
                                                            <div class="form-check form-switch">
                                                                <input class="form-check-input hatirlatici-aktif-switch" type="checkbox" role="switch" id="aktifSwitch-gecmis-{{ hatirlatici.id }}" data-hatirlatici-id="{{ hatirlatici.id }}" {% if hatirlatici.aktif %}checked{% endif %}>
                                                                <label class="form-check-label" for="aktifSwitch-gecmis-{{ hatirlatici.id }}"><span class="badge bg-success">Aktif</span></label>
                                                            </div>
                                                        {% else %}
                                                             <div class="form-check form-switch">
                                                                <input class="form-check-input hatirlatici-aktif-switch" type="checkbox" role="switch" id="aktifSwitch-gecmis-{{ hatirlatici.id }}" data-hatirlatici-id="{{ hatirlatici.id }}" {% if hatirlatici.aktif %}checked{% endif %}>
                                                                 <label class="form-check-label" for="aktifSwitch-gecmis-{{ hatirlatici.id }}"><span class="badge bg-secondary">Pasif</span></label>
                                                            </div>
                                                        {% endif %}
                                                    </td>
                                                    <td>
                                                        <div class="btn-group" role="group">
                                                            <button type="button" class="btn btn-sm btn-outline-danger delete-hatirlatici-icon" data-bs-toggle="modal" data-bs-target="#deleteConfirmationModal" data-hatirlatici-id="{{ hatirlatici.id }}">
                                                                <i class="bi bi-trash-fill"></i>
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            {% else %}
                                <div class="p-5 text-center">
                                    <div class="py-5">
                                        <i class="bi bi-calendar-x text-muted display-1 mb-3"></i>
                                        <h4>Geçmiş Hatırlatıcı Yok</h4>
                                        <p class="text-muted">Geçmiş hatırlatıcınız bulunmuyor.</p>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Takvim Görünümü -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white d-flex justify-content-between align-items-center py-3">
                    <h5 class="mb-0"><i class="bi bi-calendar3 me-2"></i> Hatırlatıcı Takvimi</h5>
                    <a href="#" class="btn btn-sm btn-outline-primary">
                        <i class="bi bi-arrows-fullscreen me-1"></i> Tam Ekran
                    </a>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle-fill me-2"></i> Takvim görünümü, hatırlatıcılarınızı aylık olarak görmenizi sağlar. Yakında kullanıma sunulacaktır.
                    </div>
                    <div class="p-4 text-center bg-light rounded">
                        <i class="bi bi-calendar2-month text-muted display-1 mb-3"></i>
                        <h5>Yakında Burada</h5>
                        <p class="text-muted">Hatırlatıcılarınızı takvim üzerinde görüntüleyebileceksiniz.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmationModal" tabindex="-1" aria-labelledby="deleteConfirmationModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteConfirmationModalLabel">Silme Onayı</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Bu hatırlatıcıyı silmek istediğinize emin misiniz? Bu işlem geri alınamaz.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Sil</button>
            </div>
        </div>
    </div>
</div>

<!-- Toast Container -->
<div class="toast-container position-fixed top-0 end-0 p-3 centralized" style="z-index: 11">
    <!-- Toasts will be appended here -->
</div>

<style>
/* Santralize Toast Container CSS */
.toast-container.centralized {
    top: 30% !important; /* Ekranın biraz daha aşağısında */
    left: 50% !important;
    transform: translate(-50%, -50%);
    right: auto !important;
    bottom: auto !important;
}

/* Büyük Toast mesajları için CSS */
.toast-large .toast-body {
    padding: 2.5rem; /* İç boşluğu biraz daha artır */
    font-size: 1.2rem; /* Yazı boyutu aynı kalsın veya hafif artırılabilir */
    font-weight: bold;
}

.toast-large {
    min-width: 400px; /* Minimum genişliği biraz daha artır */
    /* İsteğe bağlı: Daha belirgin bir border */
    /* border: 2px solid rgba(0,0,0,0.1); */
}
</style>

{% block extra_js %}
<script>
    // Toast gösterme fonksiyonu
    function showToast(message, type = 'info') {
        const toastContainer = document.querySelector('.toast-container');
        if (!toastContainer) {
            console.error('Toast container not found!');
            return;
        }

        const toastId = 'toast-' + Date.now(); // Benzersiz ID
        const toastHtml = `
            <div id="${toastId}" class="toast align-items-center text-white bg-${type} border-0 toast-large" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="d-flex">
                    <div class="toast-body">
                        ${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            </div>
        `;

        toastContainer.innerHTML = toastHtml; // Önceki toastları kaldır, yenisini ekle

        const toastEl = document.getElementById(toastId);
        if (toastEl) {
            const toast = new bootstrap.Toast(toastEl, { delay: 2000 }); // 2 saniye sonra kaybolsun
            toast.show();

             // Toast kaybolduktan sonra HTML'den kaldır
            toastEl.addEventListener('hidden.bs.toast', function () {
                toastEl.remove();
            });
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        // Anlık saat güncelleme
        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            const timeString = `${hours}:${minutes}:${seconds}`;
            
            const liveClockElement = document.getElementById('liveClock');
            if (liveClockElement) {
                liveClockElement.textContent = timeString;
            }
        }
        
        // Saati her saniye güncelle
        updateClock(); // İlk gösterme
        setInterval(updateClock, 1000);

        // Sekme içeriği yüklendikten sonra DataTable veya diğer JS kütüphanelerini başlat
        // Bootstrap sekmeleri için shown.bs.tab olayını kullanabiliriz
        const hatirlaticiTab = document.getElementById('hatirlaticiTab');
        if (hatirlaticiTab) {
            hatirlaticiTab.addEventListener('shown.bs.tab', function (event) {
                // Yeni aktif olan sekmenin içeriğindeki tabloları veya diğer elementleri burada işleyebilirsiniz
                console.log('Sekme değiştirildi: ', event.target); // Yeni aktif olan sekme
                console.log('Önceki sekme: ', event.relatedTarget); // Önceki sekme
                
                // Örneğin, yeni sekmedeki DataTable'ı başlatmak için:
                // $(event.target.getAttribute('data-bs-target')).find('table').DataTable();
            });
        }

        // DataTable başlatma (örnek - jQuery gerektirebilir)
        // Sayfa ilk yüklendiğinde aktif olan sekmenin tablosunu başlatın
        // $(document).ready( function () {
        //     $('#bugun table').DataTable();
        // });

        // Modal silme/düzenleme butonları için olay dinleyicileri (örnek)
        document.querySelectorAll('.delete-hatirlatici-icon').forEach(button => {
            button.addEventListener('click', function() {
                const hatirlaticiId = this.dataset.hatirlaticiId;
                // Store the ID in the confirm button for later use
                document.getElementById('confirmDeleteBtn').dataset.hatirlaticiId = hatirlaticiId;
                console.log('Silme onay modalı açıldı, Hatırlatıcı ID:', hatirlaticiId);
                // Modal is automatically opened by data-bs-toggle and data-bs-target
            });
        });

        // Handle confirm delete button click
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
        if (confirmDeleteBtn) {
            confirmDeleteBtn.addEventListener('click', function() {
                const hatirlaticiId = this.dataset.hatirlaticiId;
                console.log('Silme işlemi onaylandı, Hatırlatıcı ID:', hatirlaticiId);

                // Send AJAX request to delete the reminder
                fetch('{% url "yks:hatirlatici_sil" 0 %}'.replace('/0/', `/${hatirlaticiId}/`), { // Construct URL dynamically
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}',
                        'Content-Type': 'application/json' // Specify content type as JSON
                    },
                    body: JSON.stringify({}) // Send an empty JSON object or necessary data
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Close the modal
                        const deleteModal = bootstrap.Modal.getInstance(document.getElementById('deleteConfirmationModal'));
                        if (deleteModal) {
                            deleteModal.hide();
                        }
                        showToast(data.message, 'success');
                        // Reload the page after successful deletion to update the list
                        window.location.reload();
                    } else {
                        // Close the modal
                         const deleteModal = bootstrap.Modal.getInstance(document.getElementById('deleteConfirmationModal'));
                         if (deleteModal) {
                             deleteModal.hide();
                         }
                        showToast('Hata: ' + data.message, 'danger');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    // Close the modal
                     const deleteModal = bootstrap.Modal.getInstance(document.getElementById('deleteConfirmationModal'));
                     if (deleteModal) {
                         deleteModal.hide();
                     }
                    showToast('Bir hata oluştu. Lütfen tekrar deneyin.', 'danger');
                });
            });
        }

        document.querySelectorAll('.edit-hatirlatici-btn').forEach(button => {
            button.addEventListener('click', function() {
                const hatirlaticiId = this.dataset.hatirlaticiId;
                console.log('Düzenle butonuna basıldı, Hatırlatıcı ID:', hatirlaticiId);
                // Düzenleme modalını aç veya düzenleme sayfası için yönlendirme yap
            });
        });

        document.querySelectorAll('.complete-hatirlatici-btn').forEach(button => {
            button.addEventListener('click', function() {
                const hatirlaticiId = this.dataset.hatirlaticiId;
                console.log('Tamamla butonuna basıldı, Hatırlatıcı ID:', hatirlaticiId);
                // Tamamlama işlemi için AJAX isteği gönder
            });
        });

        // Yeni Hatırlatıcı Ekle butonu click eventi
        const addReminderBtnMain = document.getElementById('addReminderBtnMain');
        const addReminderBtnQuickAccess = document.getElementById('addReminderBtnQuickAccess');
        const isEmailVerified = addReminderBtnMain ? addReminderBtnMain.dataset.emailVerified === 'true' : false;
        const addReminderUrl = "{% url 'yks:hatirlatici_ekle' %}";

        function handleAddReminderClick(event) {
            if (!isEmailVerified) {
                event.preventDefault(); // Sayfa yönlendirmesini engelle
                showToast('E-posta doğrulaması yapılmadan bu özellik kullanılamaz.', 'warning');
            } else {
                // E-posta doğrulanmışsa, normal link davranışı devam eder veya manuel yönlendirilir
                // Şu an preventDefault yapmadığımız için normal link çalışacak.
                // Eğer link href'i '#' olsaydı veya preventDefault yapsaydık manuel yönlendirme gerekirdi:
                // window.location.href = addReminderUrl;
            }
        }

        if (addReminderBtnMain) {
            addReminderBtnMain.addEventListener('click', handleAddReminderClick);
        }

        if (addReminderBtnQuickAccess) {
             // Hızlı erişim butonu da aynı logic'i kullansın
            addReminderBtnQuickAccess.addEventListener('click', handleAddReminderClick);
        }

        // Hatırlatıcı aktif/pasif switchleri için olay dinleyici
        document.querySelectorAll('.hatirlatici-aktif-switch').forEach(switchEl => {
            switchEl.addEventListener('change', function() {
                const hatirlaticiId = this.dataset.hatirlaticiId;
                const yeniDurum = this.checked; // true or false
                const statusLabel = this.nextElementSibling.querySelector('.badge');

                // AJAX isteği gönder
                fetch('{% url "yks:hatirlatici_durum_guncelle" 0 %}'.replace('/0/', `/${hatirlaticiId}/`), {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': '{{ csrf_token }}',
                        'Content-Type': 'application/json',
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                     body: JSON.stringify({ aktif: yeniDurum })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // Durum yazısını ve rengini güncelle
                        if (yeniDurum) {
                            statusLabel.textContent = 'Aktif';
                            statusLabel.classList.remove('bg-secondary');
                            statusLabel.classList.add('bg-success');
                        } else {
                            statusLabel.textContent = 'Pasif';
                            statusLabel.classList.remove('bg-success');
                            statusLabel.classList.add('bg-secondary');
                        }
                        // showToast(data.message, 'success'); // İsteğe bağlı: Başarı mesajı göster
                        console.log('Hatırlatıcı durumu güncellendi:', data.message);
                    } else {
                        // Hata durumunda switch'i eski haline getir ve hata mesajı göster
                        this.checked = !yeniDurum; // Switch'i geri al
                        showToast('Durum güncellenirken hata oluştu: ' + data.message, 'danger');
                        console.error('Durum güncelleme hatası:', data.message);
                    }
                })
                .catch(error => {
                    console.error('AJAX Hatası:', error);
                    this.checked = !yeniDurum; // Switch'i geri al
                     showToast('Bir hata oluştu. Lütfen tekrar deneyin.', 'danger');
                });
            });
        });

    });
</script>
{% endblock %}

{% endblock %} 